var OP={},OPENPLATFORM=OP;OP.version='3.0.0',OP.callbacks={},OP.events={},OP.is=top!==window,OP.pending=[],OP.$appearance=0,OP.interval=setInterval(function(){OP.ready&&(clearInterval(OP.interval),OP.pending.forEach(OP.$process))},500),document.onkeydown=function(e){116===e.keyCode&&(e.returnValue=!1,e.keyCode=0,-1===location.href.indexOf('openplatform=')?location.href=OP.tokenizator(location.href):location.reload(!0))},OP.appearance=function(){OP.$appearance=1,OP.send('appearance')},OP.screenshot=function(e){if(!OP.$screenshot){var n;window.Promise||((n=document.createElement('script')).type='text/javascript',n.src=(e||'//cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0')+'/polyfill.min.js',document.body.appendChild(n)),(n=document.createElement('script')).type='text/javascript',n.src=(e||'//html2canvas.hertzen.com/dist')+'/html2canvas.min.js',document.body.appendChild(n),OP.$screenshot=1}var o=function(){OP.loading(!0),html2canvas(document.body).then(function(e){OP.send('screenshot',e.toDataURL('image/jpeg',.85)),OP.loading(!1)})},t=setInterval(function(){window.html2canvas&&(clearInterval(t),o())},1e3)},OP.launched=function(e){OP.send('launched',null,e)},OP.progress=function(e){return OP.send('progress',e)},OP.init=function(e){if(OP.ready=!1,e||(e=function(e){null!=e?(document.body.innerHTML='401: Unauthorized',setTimeout(function(){window.close()},2e3)):OP.ready=!0}),!OP.is)return e(new Error('OpenPlatform isn\'t detected.')),void(document.body.innerHTML='401: Unauthorized');for(var n=location.search.substring(1).split('&'),o=null,t=0,a=n.length;t<a;t++){var r=n[t];if('openplatform='===r.substring(0,13)){var i=decodeURIComponent(r.substring(13));OP.token=r.substring(13),o=decodeURIComponent(i.substring(i.indexOf('accesstoken=')+12));break}}var c={};c.ua=navigator.userAgent,OP.accesstoken=o;var s=setTimeout(function(){s=null,e('timeout'),document.body.innerHTML='401: Unauthorized'},2e3);OP.send('verify',c,function(n,o){s&&(clearTimeout(s),OP.ready=!n,e(null,o,setTimeout(function(){o.href&&(location.href=o.href)},100))),s=null})},document.addEventListener('click',function(){OP&&OP.focus()}),document.addEventListener('touchstart',function(){OP&&OP.focus()}),OP.loading2=function(e,n){OP.$loading2&&clearTimeout(OP.$loading2),n?OP.$loading2=setTimeout(function(e){OP.send('loading2',e)},n,e):OP.send('loading2',e)},OP.loading=function(e,n){OP.$loading&&clearTimeout(OP.$loading),n?OP.$loading=setTimeout(function(e){OP.send('loading',e)},n,e):OP.send('loading',e)},OP.success=function(e,n){return OP.snackbar(e,'success',n)},OP.warning=function(e,n){return OP.snackbar(e,'warning',n)},OP.message=function(e,n,o){var t={};return t.body=e,t.type=n,t.button=o,OP.send('message',t)},OP.confirm=function(e,n,o){var t={};return t.body=e,t.buttons=n,OP.send('confirm',t,function(e,n){o(n?n.index:-1)})},OP.snackbar=function(e,n,o){var t={};return t.body=e,t.type=n,t.button=o,OP.send('snackbar',t,o)},OP.meta=function(e){var n={};n.ua=navigator.userAgent,n.accesstoken=OP.accesstoken,OP.send('meta',n,function(n,o){e(n,o)})},OP.play=function(e){return/^(http|https):\/\//.test(e)||('/'!==e.substring(0,1)&&(e='/'+e),e=location.protocol+'//'+location.hostname+e),OP.send('play',e)},OP.stop=function(e){return OP.send('stop',e)},OP.focus=function(){return OP.send('focus')},OP.maximize=function(e){return OP.send('maximize',e)},OP.restart=function(){return OP.send('restart',location.href)},OP.open=function(e,n){return OP.send('open',{id:e,data:n})},OP.minimize=function(){return OP.send('minimize')},OP.badge=function(){return OP.send('badge')},OP.log=function(e){return OP.send('log',e)},OP.close=function(){return OP.send('kill')},OP.notify=function(e,n,o){return'string'==typeof e&&(o=n,n=e,e=0),OP.send('notify',{type:e,body:n,data:o||'',datecreated:new Date})},OP.share=function(e,n,o,t){return OP.send('share',{app:'object'==typeof e?e.id:e,type:n,body:o,datecreated:new Date,silent:t})},OP.email=function(e,n){return OP.send('email',{subject:e,body:n,datecreated:new Date})},OP.send=function(e,n,o){'function'==typeof n&&(o=n,n=null);var t={};if(t.openplatform=!0,t.accesstoken=OP.accesstoken,t.type=e,t.body=n||null,t.sender=!0,t.origin=location.protocol+'//'+location.hostname,top)return o&&(t.callback=(1e6*Math.random()).toString(32).replace(/\./g,''),OP.callbacks[t.callback]=o),top.postMessage(JSON.stringify(t),'*'),OP;o&&o(new Error('The application is not running in the OpenPlatform scope.'))},OP.on=function(e,n){return!OP.events[e]&&(OP.events[e]=[]),OP.events[e].push(n),OP},OP.$process=function(e){if(e.callback){var n=OP.callbacks[e.callback];n&&(e.sender&&(e.error=new Error('The application is not running in the OpenPlatform scope.')),n(e.error,e.body||{}),delete OP.callbacks[e.callback])}else if(!e.sender){if('appearance'===e.type&&OP.$appearance){var o=document.head||document.getElementsByTagName('head')[0],t=document.createElement('style');1===OP.$appearance?OP.$appearance=2:document.getElementById('opstyle').remove();var a=e.body,r=document.body.classList;r.add(a.darkmode?'opdark':'oplight'),r.add('opbody'),r.remove(a.darkmode?'oplight':'opdark'),window.OPCOLOR=a.colorscheme,window.OPDARKMODE=a.darkmode,t.appendChild(document.createTextNode('.opbody{background-color:#'+(a.darkmode?'353535':'FFFFFF')+'}.opborder{border-color:'+a.colorscheme+'}.opbg{background-color:'+a.colorscheme+'}.opfg{color:'+a.colorscheme+'}')),t.id='opstyle',o.appendChild(t)}if('reload'!==e.type)if('screenshotmake'!==e.type)if('redirect'!==e.type){'kill'===e.type&&(e.type='close'),'share'===e.type&&(e.body.share=function(e,n){OP.share(this.app,e,n)});var i=OP.events[e.type];i&&i.forEach(function(n){n(e.body||{})})}else location.href=e.body;else OP.screenshot(e.body);else-1===location.href.indexOf('openplatform=')?location.href=OP.tokenizator(location.href):location.reload(!0)}},window.addEventListener('message',function(e){try{var n=JSON.parse(e.data);if(!n.openplatform)return;OP.ready||'verify'===n.type?OP.$process(n):OP.pending.push(n)}catch(e){}},!1),OP.tokenizator=function(e){var n=e.indexOf('?');return-1===n?e+'?openplatform='+OP.token:e.substring(0,n+1)+'openplatform='+OP.token+'&'+e.substring(n+1)},window.history&&(history.pushState(null,null,location.href),window.onpopstate=function(){history.go(1)});