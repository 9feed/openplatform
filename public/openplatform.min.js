var OPENPLATFORM={};OPENPLATFORM.version='3.0.0',OPENPLATFORM.callbacks={},OPENPLATFORM.events={},OPENPLATFORM.is=top!==window,OPENPLATFORM.screenshot=function(){if(!OPENPLATFORM.$screenshot){var n=document.createElement('script');n.type='text/javascript',n.src='//html2canvas.hertzen.com/dist/html2canvas.min.js',document.body.append(n),OPENPLATFORM.$screenshot=1}var e=function(){html2canvas(document.body).then(function(n){OPENPLATFORM.send('screenshot',n.toDataURL('image/jpeg',.85))})},t=setInterval(function(){window.html2canvas&&(clearInterval(t),e())},1e3)},OPENPLATFORM.progress=function(n){return OPENPLATFORM.send('progress',n)},OPENPLATFORM.init=function(n){if(n||(n=function(n){null!=n&&(document.body.innerHTML='401: Unauthorized',setTimeout(function(){window.close()},2e3))}),OPENPLATFORM.is){for(var e=location.search.substring(1).split('&'),t=null,o=0,r=e.length;o<r;o++){var O=e[o];if('openplatform='===O.substring(0,13)){var P=decodeURIComponent(O.substring(13));OPENPLATFORM.token=O.substring(13),t=decodeURIComponent(P.substring(P.indexOf('accesstoken=')+12));break}}var i={};i.ua=navigator.userAgent,OPENPLATFORM.accesstoken=t;var a=setTimeout(function(){a=null,n('timeout')},1500);OPENPLATFORM.send('verify',i,function(e,t){a&&(clearTimeout(a),n(null,t,setTimeout(function(){t.href&&(location.href=t.href)},100))),a=null})}else n(new Error('OpenPlatform isn\'t detected.'))},document.addEventListener('click',function(){OPENPLATFORM&&OPENPLATFORM.focus()}),OPENPLATFORM.loading=function(n,e){e?setTimeout(function(n){OPENPLATFORM.send('loading',n)},e,n):OPENPLATFORM.send('loading',n)},OPENPLATFORM.message=function(n,e){var t={};return t.body=n,t.type=e,OPENPLATFORM.send('message',t)},OPENPLATFORM.confirm=function(n,e,t){var o={};return o.body=n,o.buttons=e,OPENPLATFORM.send('confirm',o,t)},OPENPLATFORM.snackbar=function(n,e){var t={};return t.body=n,t.type=e,OPENPLATFORM.send('snackbar',t)},OPENPLATFORM.meta=function(n){var e={};e.ua=navigator.userAgent,e.accesstoken=OPENPLATFORM.accesstoken,OPENPLATFORM.send('meta',e,function(e,t){n(e,t)})},OPENPLATFORM.play=function(n){return OPENPLATFORM.send('play',n)},OPENPLATFORM.stop=function(n){return OPENPLATFORM.send('stop',n)},OPENPLATFORM.focus=function(){return OPENPLATFORM.send('focus')},OPENPLATFORM.maximize=function(n){return OPENPLATFORM.send('maximize',n)},OPENPLATFORM.restart=function(){return OPENPLATFORM.send('restart',location.href)},OPENPLATFORM.open=function(n,e){return OPENPLATFORM.send('open',{id:n,data:e})},OPENPLATFORM.minimize=function(){return OPENPLATFORM.send('minimize')},OPENPLATFORM.badge=function(){return OPENPLATFORM.send('badge')},OPENPLATFORM.log=function(n){return OPENPLATFORM.send('log',n)},OPENPLATFORM.close=function(){return OPENPLATFORM.send('kill')},OPENPLATFORM.notify=function(n,e,t){return'string'==typeof n&&(t=e,e=n,n=0),OPENPLATFORM.send('notify',{type:n,body:e,data:t||'',datecreated:new Date})},OPENPLATFORM.share=function(n,e,t,o){return OPENPLATFORM.send('share',{app:'object'==typeof n?n.id:n,type:e,body:t,datecreated:new Date},o)},OPENPLATFORM.email=function(n,e){return OPENPLATFORM.send('email',{subject:n,body:e,datecreated:new Date})},OPENPLATFORM.send=function(n,e,t){'function'==typeof e&&(t=e,e=null);var o={};if(o.openplatform=!0,o.accesstoken=OPENPLATFORM.accesstoken,o.type=n,o.body=e||null,o.sender=!0,o.origin=location.origin,top)return t&&(o.callback=(1e6*Math.random()).toString(32).replace(/\./g,''),OPENPLATFORM.callbacks[o.callback]=t),top.postMessage(JSON.stringify(o),'*'),OPENPLATFORM;t&&t(new Error('The application is not running in the OpenPlatform scope.'))},OPENPLATFORM.on=function(n,e){return!OPENPLATFORM.events[n]&&(OPENPLATFORM.events[n]=[]),OPENPLATFORM.events[n].push(e),OPENPLATFORM},window.addEventListener('message',function(n){try{var e=JSON.parse(n.data);if(!e.openplatform)return;if(e.callback){var t=OPENPLATFORM.callbacks[e.callback];return void(t&&(e.sender&&(e.error=new Error('The application is not running in the OpenPlatform scope.')),t(e.error,e.body||{}),delete OPENPLATFORM.callbacks[e.callback]))}if(e.sender)return;if('reload'===e.type)return void(-1===location.href.indexOf('openplatform=')?location.href=OPENPLATFORM.tokenizator(location.href):location.reload(!0));if('screenshot'===e.type)return void OPENPLATFORM.screenshot();if('redirect'===e.type)return void(location.href=e.body);'kill'===e.type&&(e.type='close');var o=OPENPLATFORM.events[e.type];o&&o.forEach(function(n){n(e.body||{})})}catch(n){}},!1),OPENPLATFORM.tokenizator=function(n){var e=n.indexOf('?');return-1===e?n+'?openplatform='+OPENPLATFORM.token:n.substring(0,e+1)+'openplatform='+OPENPLATFORM.token+'&'+n.substring(e+1)};