<style>
	/*auto*/
	.accountphoto { background-color: #F0F0F0; padding: 20px 0; }
	.accountphoto img { max-width: 110px; }
	.ui-appearance { height: 55px; }
	.ui-appearance-label { float: left; padding: 5px 0 0 0; font-size: 12px; width: 250px; }
	.ui-appearance-label i { margin-right: 5px; }
	.ui-appearance-option { background-image: url(../img/appearance.png); border-radius: 3px; border: 2px solid #E0E0E0; width: 80px; height: 55px; float: right; margin-left: 10px; text-align: center; font-size: 11px; padding: 19px 0 0 20px; cursor: pointer; }
	.ui-appearance-selected { border-color: #49a7f8 !important; }
	.ui-appearance-light { background-position: -7px 0; background-size: 175px 51px; color: black; }
	.ui-appearance-dark { background-position: 80px 0; background-size: 175px 51px; color: white; }
	.col-2 { float: left; width: 50%; padding-left: 15px; padding-right: 15px; }

	.ui-dark .accountphoto { background: #333333 linear-gradient(0deg,#000,#404040); }
	.ui-dark .ui-appearance-option { border-color: #404040; }

	@media(max-width: 450px) {
		.col-2 { float: none; display: block; width: 100%; }
		.ui-appearance-label { float: none; width: 100%; }
		.ui-appearance-option { float: left; margin: 10px 10px 0 0; }
		.ui-appearance { height: 110px; }
	}

	.volume { height: 20px; padding: 0; font-size: 11px; border: 1px solid #E0E0E0; border-radius: 2px; margin: 8px 0 0; }
	.volume > div { margin-left: 20px; }
	.volume span { width: 33.33%; float: left; border-left: 1px solid #E0E0E0; text-align: center; line-height: 18px; cursor: pointer; }
	.volume span:first-child { border-left: 0; }
	.volume i { float: left; line-height: 18px; height: 18px; width: 20px; background-color: #F0F0F0; border-radius: 2px 0 0 2px; text-align: center; font-size: 10px; }

	@{if user.colorscheme}
	.ui-checkbox-checked div{background-color:@{user.colorscheme}!important;border-color:@{user.colorscheme}!important}
	.button{background-color:@{user.colorscheme}}
	.volume .selected {background-color:@{user.colorscheme};color:white}
	.ui-singleupload{color:@{user.colorscheme}!important}
	@{else}
	.volume .selected {background-color:#4285f4;color:white}
	@{fi}

</style>

<div data---="audio__account.volume"></div>

<div class="row">
	<div data---="scrollbar__account__margin:40;parent:window;track:changepassword,response">

		<div class="accountphoto">
			<div data---="preview__account.photo__url:/api/upload/photo/;width:300;height:300;format:/photos/{0}"></div>
			<div class="help center"><i class="fa fa-camera"></i>@(300x300 pixels)</div>
		</div>

		<div class="scroller-padding">

			<div class="row">
				<div class="col-2 m">
					<div data---="input__account.email__type:email;innerlabel:1;required:1">@(Email address)</div>
				</div>
				<div class="col-2 m">
					<div data---="input__account.phone__innerlabel:1">@(Phone number)</div>
				</div>
			</div>
			<div data---="colorselector__account.colorscheme__null" style="margin-bottom:5px"></div>
			<div style="font-size:12px">
				<div style="float:left" class="mr5"><i class="fa fa-camera mr5"></i>@(Background image:)</div>
				<div data---="singleupload__account.background__url:/api/upload/background/;title:{{}};accept:image/*" class="b ui-singleupload">@(Upload image)</div>
			</div>
			<div class="clearfix"></div>
			<hr />
			<div class="ui-appearance" data---="appearance__account.darkmode">
				<div class="ui-appearance-label">
					<i class="fa fa-paint-brush"></i>@(Appearance):
					<div class="help" style="margin-top:2px">@(You can choose light or dark mode. Not all apps support appearance.)</div>
				</div>
				<div class="ui-appearance-option ui-appearance-dark">@(Dark)</div>
				<div class="ui-appearance-option ui-appearance-light ui-appearance-selected">@(Light)</div>
			</div>
			<hr />

			<div class="row">
				<div class="col-2">
					<div data---="checkbox__account.notifications">@(Enable notifications)</div>
					<div data---="checkbox__account.notificationsemail">@(Enable email notifications)</div>
					<div data---="checkbox__account.notificationsphone">@(Enable phone notifications)</div>
				</div>
				<div class="col-2">
					<div data---="checkbox__account.sounds">@(Enable sounds)</div>
					<div data---="checkbox__account.changepassword" class="b red">@(Change password)</div>
				</div>
			</div>

			<div class="volume" data-bind="account.volume__click span:account_volume_set__exec:account_volume">
				<i class="fa fa-volume-up"></i>
				<div>
					<span data-volume="15">@(silent)</span>
					<span data-volume="50">@(medium)</span>
					<span data-volume="100">@(loud)</span>
				</div>
			</div>

			<div data-bind="account.changepassword__show:!!value" class="hidden bg-smoke" style="margin-top:15px">
				<div class="padding">
					<div data---="input__account.password__maxlength:30;type:password;required:1;innerlabel:1">@(Login password)</div>
					<div class="help"><i class="fa fa-info-circle"></i>@(Passsword will be encrypted.)</div>
				</div>
			</div>

		</div>

		<div class="scroller-padding bg-yellow-fade npb">
			<h2><i class="fa fa-lock"></i>@(Screen locking)</h2>
			<div class="fs12 m">@(Screen will be locked only on desktop computers. )</div>
			<div class="row">
				<div class="col-xs-6">
					<div data---="input__account.locking__maxlength:30;type:number;innerlabel:1;placeholder:@(In minutes)">@(Idle time)</div>
					<div class="help m"><i class="fa fa-clock"></i>@(Must be defined in minutes.)</div>
				</div>
				<div class="col-xs-6">
					<div data---="input__account.pin__maxlength:4;innerlabel:1;mask:####;maskregexp:\d,\d,\d,\d;placeholder:@(In minutes)">@(PIN code)</div>
					<div class="help m"><i class="fa fa-calculator"></i>@(Only 4 numbers.)</div>
				</div>
			</div>
		</div>
	</div>
	<div class="buttonbar" data---="validation__account">
		<button name="submit" class="button exec b" data-exec="account_submit" disabled="disabled"><i class="fa fa-floppy-o"></i>@(SAVE SETTINGS)</button>
	</div>
</div>

<script>

	OP.init(function(err, meta) {
		if (err) {
			document.body.innerHTML = '401: unauthorized';
			window.close();
		} else
			account_refresh();
	});

	function account_refresh() {
		AJAX('GET /api/account/', 'account');
	}

	function account_submit() {
		OP.loading(true);
		AJAX('POST /api/account/', GETR('account'), function(response) {
			OP.loading(false);

			if (response instanceof Array)
				OP.message(response[0].message, 'warning');

			SET('account.response', response);
			if (response.success) {
				OP.send('refreshprofile');
				OP.success('Your account has been updated successfully.');
				OP.close();
			}
		});
	}

	COMPONENT('appearance', function(self, config) {
		self.readonly();
		self.make = function() {
			self.event('click', '.ui-appearance-option', function() {
				var el = $(this);
				self.set(el.hclass('ui-appearance-dark'));
				self.change();
			});
		};

		self.setter = function(value) {
			self.find('.ui-appearance-dark').tclass('ui-appearance-selected', value === true);
			self.find('.ui-appearance-light').tclass('ui-appearance-selected', value !== true);
		};
	});

	WATCH('account.locking', function(path, value, type) {
		if (value <= 0)
			SET('account.locking', '@(disabled)');
	});

	WATCH('account.volume', function(path, value, type) {
		if (type === 2) {
			setTimeout2('volume', function() {
				SETTER('audio', 'play', '/sounds/success.mp3');
			}, 500);
		}
	});

	function account_volume_set(el) {
		SET('account.volume', +el.attrd('volume'), 2);
	}

	function account_volume(value, path, el) {
		var cls = 'selected';
		el.find('.' + cls).rclass(cls);
		el.find('span[data-volume="{0}"]'.format(value)).aclass('selected');
		CHANGE('account.email');
	}

	ON('resize', function() {
		setTimeout2('resize', function() {
			resizelayout();
			SETTER('scrollbar', 'resize');
		}, 100);
	});

</script>